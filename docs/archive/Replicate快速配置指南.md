# ğŸš€ Replicate API å¿«é€Ÿé…ç½®æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦ï¼š
- âœ… Node.js ç¯å¢ƒ
- âœ… é¡¹ç›®å·²æœ‰çš„R2é…ç½®
- âœ… Replicateè´¦å·ï¼ˆå…è´¹æ³¨å†Œï¼‰

---

## ğŸ¯ æ­¥éª¤1ï¼šæ³¨å†ŒReplicateè´¦å·

### 1.1 è®¿é—®Replicateå®˜ç½‘
```
https://replicate.com/
```

### 1.2 æ³¨å†Œè´¦å·
- ç‚¹å‡» "Sign up"
- å¯ä»¥ä½¿ç”¨GitHubè´¦å·å¿«é€Ÿç™»å½•
- å®Œå…¨å…è´¹æ³¨å†Œï¼Œæ— éœ€ä¿¡ç”¨å¡

### 1.3 è·å–API Token
1. ç™»å½•åè®¿é—®ï¼šhttps://replicate.com/account/api-tokens
2. ç‚¹å‡» "Create token"
3. è¾“å…¥Tokenåç§°ï¼ˆå¦‚ï¼š`my-ai-image-generator`ï¼‰
4. å¤åˆ¶ç”Ÿæˆçš„Tokenï¼ˆæ ¼å¼ï¼š`r8_xxxxxxxxxxxxx`ï¼‰

âš ï¸ **é‡è¦**ï¼šTokenåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹å³ä¿å­˜ï¼

---

## ğŸ¯ æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–

åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œï¼š

```bash
npm install replicate sharp
```

**ä¾èµ–è¯´æ˜**ï¼š
- `replicate` - Replicate APIå®¢æˆ·ç«¯
- `sharp` - å›¾ç‰‡å¤„ç†åº“ï¼ˆç”¨äºè·å–å°ºå¯¸ä¿¡æ¯ï¼‰

---

## ğŸ¯ æ­¥éª¤3ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ Replicate API Tokenï¼š

```env
# Replicate APIé…ç½®
REPLICATE_API_TOKEN=r8_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# å…¶ä»–ç°æœ‰é…ç½®ä¿æŒä¸å˜
TONGYI_API_KEY=sk-xxxxx
R2_ACCOUNT_ID=xxxxx
R2_ACCESS_KEY_ID=xxxxx
R2_SECRET_ACCESS_KEY=xxxxx
R2_BUCKET_NAME=images
R2_ENDPOINT=https://xxxxx.r2.cloudflarestorage.com
R2_PUBLIC_URL=https://pub-xxxxx.r2.dev
```

---

## ğŸ¯ æ­¥éª¤4ï¼šåˆ‡æ¢åˆ°ReplicateæœåŠ¡å™¨

### æ–¹æ³•1ï¼šé‡å‘½åæ–‡ä»¶ï¼ˆæ¨èï¼‰
```bash
# å¤‡ä»½å½“å‰æœåŠ¡å™¨
mv server-with-r2.js server-with-r2-backup.js

# ä½¿ç”¨Replicateç‰ˆæœ¬
mv server-replicate.js server-with-r2.js
```

### æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œ
```bash
# ç›´æ¥è¿è¡ŒReplicateç‰ˆæœ¬
node server-replicate.js
```

---

## ğŸ¯ æ­¥éª¤5ï¼šå¯åŠ¨æœåŠ¡å™¨

```bash
node server-replicate.js
```

### æœŸæœ›çœ‹åˆ°çš„è¾“å‡ºï¼š
```
============================================================
ğŸ¨ AIå›¾ç‰‡ç”ŸæˆæœåŠ¡å™¨å·²å¯åŠ¨ï¼ˆReplicate + R2å­˜å‚¨ï¼‰
============================================================
ğŸ“¡ æœåŠ¡åœ°å€: http://localhost:3000
ğŸ”§ æ–‡å­—ç”Ÿæˆ: http://localhost:3000/api/tongyi/generate
ğŸ“¸ å›¾ç”Ÿå›¾: http://localhost:3000/api/img2img/generate
ğŸ” é«˜æ¸…æ”¾å¤§: http://localhost:3000/api/upscale/process
ğŸ“§ è”ç³»è¡¨å•: http://localhost:3000/api/contact
ğŸ’š å¥åº·æ£€æŸ¥: http://localhost:3000/health
============================================================

â˜ï¸  Cloudflare R2 é…ç½®:
   å­˜å‚¨æ¡¶: images
   ç«¯ç‚¹: https://xxxxx.r2.cloudflarestorage.com
   å…¬å¼€URL: https://pub-xxxxx.r2.dev
ğŸ” æµ‹è¯•R2è¿æ¥...
âœ… R2è¿æ¥æˆåŠŸ
ğŸ” æµ‹è¯•Replicateè¿æ¥...
âœ… Replicate API Token å·²é…ç½®
âœ… ç°åœ¨å¯ä»¥æ‰“å¼€ http://localhost:3000/tool.html ä½¿ç”¨äº†ï¼
   å›¾ç‰‡å°†è‡ªåŠ¨ä¸Šä¼ åˆ°R2å­˜å‚¨æ¡¶å¹¶æ°¸ä¹…ä¿å­˜
============================================================
```

---

## ğŸ¯ æ­¥éª¤6ï¼šæµ‹è¯•åŠŸèƒ½

### æµ‹è¯•å›¾ç”Ÿå›¾
1. è®¿é—® http://localhost:3000/tool.html
2. ç‚¹å‡» **[å›¾ç”Ÿå›¾]** æ ‡ç­¾
3. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
4. è¾“å…¥æç¤ºè¯ï¼ˆå¯é€‰ï¼‰ï¼š`è½¬æ¢ä¸ºæ²¹ç”»é£æ ¼`
5. è°ƒæ•´å˜åŒ–ç¨‹åº¦æ»‘å—
6. ç‚¹å‡» **"å¼€å§‹é‡ç»˜"**
7. ç­‰å¾…çº¦10-20ç§’
8. æŸ¥çœ‹ç”Ÿæˆçš„çœŸå®AIå›¾ç‰‡ï¼

### æµ‹è¯•é«˜æ¸…æ”¾å¤§
1. ç‚¹å‡» **[é«˜æ¸…æ”¾å¤§]** æ ‡ç­¾
2. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
3. é€‰æ‹©æ”¾å¤§å€æ•°ï¼ˆ2x æˆ– 4xï¼‰
4. å‹¾é€‰å¢å¼ºé€‰é¡¹
5. ç‚¹å‡» **"å¼€å§‹æ”¾å¤§"**
6. ç­‰å¾…çº¦30-60ç§’
7. æŸ¥çœ‹æ”¾å¤§ç»“æœå¯¹æ¯”ï¼

---

## ğŸ’° è´¹ç”¨è¯´æ˜

### å›¾ç”Ÿå›¾ï¼ˆStable Diffusion XLï¼‰
- **ä»·æ ¼**ï¼šçº¦ $0.003-0.005/å¼ 
- **è®¡è´¹æ–¹å¼**ï¼šæŒ‰ç§’è®¡è´¹
- **é¢„ä¼°**ï¼šç”Ÿæˆä¸€å¼ å›¾çº¦éœ€è¦5-10ç§’

### é«˜æ¸…æ”¾å¤§ï¼ˆReal-ESRGANï¼‰
- **ä»·æ ¼**ï¼šçº¦ $0.005/å¼ 
- **è®¡è´¹æ–¹å¼**ï¼šæŒ‰å¤„ç†æ—¶é—´è®¡è´¹
- **é¢„ä¼°**ï¼šæ”¾å¤§ä¸€å¼ å›¾çº¦éœ€è¦10-30ç§’

### å…è´¹é¢åº¦
- Replicateæä¾›ä¸€å®šçš„å…è´¹æµ‹è¯•é¢åº¦
- æ–°ç”¨æˆ·é€šå¸¸æœ‰$5-10å…è´¹é¢åº¦
- è¶³å¤Ÿæµ‹è¯•å‡ ç™¾æ¬¡

### è´¹ç”¨æ§åˆ¶
1. åœ¨Replicateåå°è®¾ç½®é¢„ç®—é™åˆ¶
2. è®¿é—®ï¼šhttps://replicate.com/account/billing
3. è®¾ç½®æ¯æœˆæœ€é«˜æ¶ˆè´¹é™é¢

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šTokenæ— æ•ˆ
```
é”™è¯¯ä¿¡æ¯ï¼šAuthentication failed
è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥.envæ–‡ä»¶ä¸­çš„REPLICATE_API_TOKENæ˜¯å¦æ­£ç¡®
2. ç¡®ä¿Tokenæ²¡æœ‰ç©ºæ ¼æˆ–æ¢è¡Œ
3. é‡æ–°ç”ŸæˆTokenå¹¶æ›¿æ¢
```

### é—®é¢˜2ï¼šä¾èµ–å®‰è£…å¤±è´¥
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install
```

### é—®é¢˜3ï¼šç”Ÿæˆæ—¶é—´è¿‡é•¿
```
åŸå› ï¼šReplicateçš„cold startå¯èƒ½éœ€è¦ç­‰å¾…
è§£å†³ï¼šé¦–æ¬¡ä½¿ç”¨æŸä¸ªæ¨¡å‹éœ€è¦30-60ç§’åˆå§‹åŒ–ï¼Œä¹‹åä¼šå¿«å¾ˆå¤š
```

### é—®é¢˜4ï¼šR2ä¸Šä¼ å¤±è´¥
```
æ£€æŸ¥R2é…ç½®æ˜¯å¦æ­£ç¡®
ç¡®ä¿R2_BUCKET_NAMEã€R2_ENDPOINTç­‰éƒ½å·²é…ç½®
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ¨¡æ‹Ÿç‰ˆ vs Replicateç‰ˆ

| åŠŸèƒ½ | æ¨¡æ‹Ÿç‰ˆ | Replicateç‰ˆ |
|------|--------|-------------|
| å›¾ç”Ÿå›¾ | âŒ SVGå ä½å›¾ | âœ… çœŸå®AIå›¾ç‰‡ |
| é«˜æ¸…æ”¾å¤§ | âŒ SVGå ä½å›¾ | âœ… çœŸå®æ”¾å¤§ |
| å¤„ç†æ—¶é—´ | 2-3ç§’ | 10-60ç§’ |
| è´¹ç”¨ | å…è´¹ | çº¦$0.005/å¼  |
| è´¨é‡ | æ—  | â­â­â­â­â­ |

---

## ğŸ¨ é«˜çº§é…ç½®

### è‡ªå®šä¹‰æ¨¡å‹å‚æ•°

ç¼–è¾‘ `server-replicate.js`ï¼Œæ‰¾åˆ°å¯¹åº”çš„APIè°ƒç”¨ï¼š

#### å›¾ç”Ÿå›¾å‚æ•°è°ƒæ•´
```javascript
const output = await replicate.run(
    "stability-ai/sdxl:...",
    {
        input: {
            image: imageBase64,
            prompt: fullPrompt,
            strength: 0.5,              // 0-1ï¼Œå˜åŒ–ç¨‹åº¦
            num_outputs: 1,             // ç”Ÿæˆæ•°é‡
            num_inference_steps: 25,    // æ­¥æ•°ï¼ˆè¶Šå¤šè¶Šç²¾ç»†ï¼‰
            guidance_scale: 7.5,        // æç¤ºè¯å¼ºåº¦
            scheduler: "K_EULER",       // é‡‡æ ·å™¨
        }
    }
);
```

#### é«˜æ¸…æ”¾å¤§å‚æ•°è°ƒæ•´
```javascript
const output = await replicate.run(
    "nightmareai/real-esrgan:...",
    {
        input: {
            image: imageBase64,
            scale: 2,                   // 2æˆ–4
            face_enhance: true,         // é¢éƒ¨å¢å¼º
        }
    }
);
```

---

## ğŸŒŸ å…¶ä»–å¯ç”¨æ¨¡å‹

### å›¾ç”Ÿå›¾æ›¿ä»£æ¨¡å‹

1. **Stable Diffusion v1.5**ï¼ˆæ›´å¿«ï¼Œè´¨é‡ç¨ä½ï¼‰
```javascript
"stability-ai/stable-diffusion:..."
```

2. **Kandinsky 2.2**ï¼ˆç‹¬ç‰¹é£æ ¼ï¼‰
```javascript
"ai-forever/kandinsky-2-2:..."
```

### é«˜æ¸…æ”¾å¤§æ›¿ä»£æ¨¡å‹

1. **GFPGAN**ï¼ˆæ›´å¥½çš„é¢éƒ¨ä¿®å¤ï¼‰
```javascript
"tencentarc/gfpgan:..."
```

2. **CodeFormer**ï¼ˆä¸“ä¸šé¢éƒ¨ä¿®å¤ï¼‰
```javascript
"sczhou/codeformer:..."
```

---

## âœ… å®Œæˆæ¸…å•

- [ ] Replicateè´¦å·å·²æ³¨å†Œ
- [ ] API Tokenå·²è·å–å¹¶é…ç½®
- [ ] ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆreplicate, sharpï¼‰
- [ ] .envæ–‡ä»¶å·²é…ç½®
- [ ] æœåŠ¡å™¨å·²åˆ‡æ¢åˆ°server-replicate.js
- [ ] æœåŠ¡å™¨æˆåŠŸå¯åŠ¨
- [ ] å›¾ç”Ÿå›¾åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] é«˜æ¸…æ”¾å¤§åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ç”Ÿæˆçš„å›¾ç‰‡å·²ä¿å­˜åˆ°R2

---

## ğŸ‰ æ­å–œï¼

æ‚¨å·²æˆåŠŸé›†æˆçœŸå®çš„AIæœåŠ¡ï¼

ç°åœ¨æ‚¨çš„ç½‘ç«™æ‹¥æœ‰ï¼š
- âœ… æ–‡å­—ç”Ÿæˆå›¾ç‰‡ï¼ˆé€šä¹‰ä¸‡ç›¸ï¼‰
- âœ… å›¾ç”Ÿå›¾ï¼ˆReplicate SDXLï¼‰
- âœ… é«˜æ¸…æ”¾å¤§ï¼ˆReplicate Real-ESRGANï¼‰
- âœ… æ‰€æœ‰å›¾ç‰‡æ°¸ä¹…å­˜å‚¨åœ¨R2

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- Replicateæ–‡æ¡£ï¼šhttps://replicate.com/docs
- Replicateç¤¾åŒºï¼šhttps://replicate.com/explore
- APIå‚è€ƒï¼šhttps://replicate.com/docs/reference/http

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `docs/å¤–éƒ¨AIæœåŠ¡é›†æˆæŒ‡å—.md` è·å–æ›´å¤šä¿¡æ¯ï¼

