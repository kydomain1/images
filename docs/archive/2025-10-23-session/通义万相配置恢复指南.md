# 🔍 通义万相 API 配置说明

## 📊 当前状态

### **通义万相配置在以下位置：**

#### 1. **前端配置（js/api-config.js）**
```javascript
provider: 'tongyi',  // ← 设置为使用通义万相
```

#### 2. **环境变量（.env文件）**
```env
TONGYI_API_KEY=sk-xxxxx  # ← 需要在这里配置
```

#### 3. **服务器端（server-with-r2.js）**
```javascript
const TONGYI_API_KEY = process.env.TONGYI_API_KEY;
// 服务器会读取.env中的Key
```

---

## ❓ 可能的情况

### **情况A：.env文件被重置了**

当我配置 RemoveBG API 时，创建了新的 .env 文件，但可能**没有包含通义万相的Key**。

**当前.env内容：**
```env
REMOVEBG_API_KEY=haL8i6ppfcmj679J2WKyW31L  # ← 有
TONGYI_API_KEY=                            # ← 空的！
```

---

### **情况B：从未配置过通义万相**

如果您之前没有实际配置通义万相API Key，那么：
- 前端设置为 `provider: 'tongyi'`
- 但服务器没有Key
- 所以会失败并自动使用其他方案

---

## 🎯 当前实际使用的是什么？

### **查看代码配置：**

**api-config.js 第7行：**
```javascript
provider: 'tongyi',  // 使用通义万相API（服务器已启动）
```

但实际上，如果通义万相API Key为空，图片生成功能可能：
1. 尝试调用通义万相 → 失败
2. 降级到其他API
3. 或者使用Pollinations（免费）

---

## 💡 两个选择

### **选择A：继续使用 Pollinations（推荐）**

**修改前端配置：**

编辑 `js/api-config.js` 第7行：
```javascript
// 从
provider: 'tongyi',

// 改为
provider: 'pollinations',  // 使用免费的Pollinations
```

**优势：**
- ✅ 完全免费
- ✅ 无限制使用
- ✅ 效果不错
- ✅ 无需API Key

---

### **选择B：配置通义万相API**

如果您有通义万相API Key，请提供给我：

**步骤：**
1. 提供您的通义万相API Key（格式：`sk-xxx...`）
2. 我更新 .env 文件
3. 重启服务器
4. 使用通义万相生成图片

**优势：**
- ⭐ 可能质量更好（针对中文优化）
- ⭐ 支持更多样式

**成本：**
- 💰 按量付费（阿里云）
- 💰 相对较贵

---

## 🤔 我的建议

**推荐选择A：切换到 Pollinations**

**原因：**
1. ✅ 当前已经在用（降级方案）
2. ✅ 完全免费
3. ✅ 效果很好
4. ✅ 无需配置

**如果您从未配置过通义万相：**
→ 说明Pollinations一直在正常工作
→ 保持现状即可

**如果您有通义万相Key：**
→ 告诉我Key
→ 我帮您恢复配置

---

## 📝 快速检查

**您有通义万相 API Key 吗？**

**是** → 告诉我Key（格式：`sk-xxx...`），我立即配置  
**否** → 我帮您切换到Pollinations（已经在用，只是配置文件需要更新）

**不确定** → 告诉我，我帮您检查当前到底在用什么

---

请告诉我您的选择！🎯

