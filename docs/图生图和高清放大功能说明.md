# 图生图功能完整使用指南

## ✅ 当前状态

**后端服务器已启动并运行！**
- 🟢 服务地址：http://localhost:3000
- 🟢 图生图API：http://localhost:3000/api/img2img/generate
- 🟢 高清放大API：http://localhost:3000/api/upscale/process
- 🟢 健康检查：http://localhost:3000/health

---

## 🎨 功能说明

### 1. **智能模式切换**

系统会自动检测后端服务器状态：

#### 🟢 后端模式（推荐）
- ✅ 真实图生图功能
- ✅ 基于上传的图片进行AI转换
- ✅ 支持风格转换、细节增强
- ✅ 高质量输出

#### 🔵 降级模式（无后端）
- ⚠️ 基于文字描述生成图片
- 📝 使用Pollinations.ai免费服务
- 🎨 上传图片仅作参考
- 💡 适合快速测试

---

## 🚀 使用方法

### 方式一：使用启动脚本（推荐）

双击运行：`scripts/启动后端服务器.bat`

### 方式二：命令行启动

```bash
cd D:\images
node server-with-r2.js
```

---

## 🖼️ 图生图功能使用

1. **确保后端服务器已启动**
   - 页面顶部会显示 🟢 **后端模式**（绿色横幅）
   
2. **打开图生图功能**
   - 访问 http://localhost:3000/tool.html
   - 点击 **"图生图"** 标签

3. **上传参考图片**
   - 拖拽图片到上传区
   - 或点击"选择图片"按钮
   - 支持 JPG、PNG、WebP 格式（最大10MB）

4. **设置转换参数**
   - **提示词**：描述想要的效果（可使用优化器）
   - **转换强度**：0.1-1.0（值越大变化越大）
   - **艺术风格**：油画、水彩、动漫、素描等
   - **图片尺寸**：1024x1024、1280x720等

5. **点击"开始转换"**
   - 系统会上传图片并调用AI接口
   - 等待2-5秒（取决于图片大小）
   - 查看生成结果

---

## 🎯 提示词优化器

### 快速模板（22个专业模板）

**🎨 风格转换**
- 油画风格、动漫风格、水彩画
- 素描风格、赛博朋克、复古胶片

**✨ 细节增强**
- 细节增强、色彩增强
- 光线优化、艺术化

**🌟 氛围调整**
- 温暖氛围、冷色调
- 梦幻感、戏剧性

**🎭 特殊效果**
- 黑白艺术、极简风格
- 3D渲染、插画风格

### 使用方法

1. 点击 **"图生图模板"** 按钮
2. 浏览4大类别的模板
3. 点击任意模板自动填入提示词
4. 根据需要调整内容

---

## ⚙️ API配置说明

### 当前状态
- ✅ 后端服务器运行正常
- ⚠️ 使用模拟数据（开发模式）

### 接入真实AI服务

**推荐服务：**

1. **Replicate** - 强大的AI模型平台
   - 网址：https://replicate.com/
   - 月免费额度：50美元
   - 支持Stable Diffusion img2img

2. **Hugging Face** - 开源AI社区
   - 网址：https://huggingface.co/
   - 完全免费（有速率限制）
   - 多种模型可选

详细配置方法：`docs/图生图免费API推荐.md`

---

## 🔍 高清放大功能

### 功能说明
- 📈 支持2x、4x放大
- ✨ AI智能降噪
- 🎨 细节增强
- 👤 面部修复

### 使用方法
1. 切换到"高清放大"标签
2. 上传图片
3. 选择放大倍数和优化选项
4. 点击"开始放大"

**注意：** 当前为模拟实现，接入真实服务请参考配置文档。

---

## 🐛 故障排查

### 问题1：页面显示"降级模式"

**原因：** 后端服务器未启动

**解决：**
```bash
# 重新启动服务器
cd D:\images
node server-with-r2.js
```

### 问题2：上传图片后报错

**原因：** 文件格式或大小不符合要求

**解决：**
- 确保图片格式为 JPG/PNG/WebP
- 确保图片大小 < 10MB
- 尝试压缩图片后重新上传

### 问题3：生成速度很慢

**原因：** 当前使用模拟数据或网络延迟

**解决：**
- 检查网络连接
- 配置本地AI模型（推荐）
- 使用更快的API服务

### 问题4：生成结果是模拟图片

**原因：** 未配置真实AI服务

**解决：**
- 查看 `docs/图生图免费API推荐.md`
- 配置Replicate或其他AI服务的API密钥
- 修改 `server-with-r2.js` 的实现代码

---

## 📊 技术架构

### 前端
- `tool.html` - 图生图UI界面
- `js/img2img.js` - 核心逻辑（+600行）
- `js/i18n.js` - 多语言支持
- `css/style.css` - 样式定义

### 后端
- `server-with-r2.js` - Express服务器
- `/api/img2img/generate` - 图生图端点
- `/api/upscale/process` - 高清放大端点
- Multer - 文件上传处理

### 智能降级
- 自动检测后端状态
- 后端不可用时使用Pollinations.ai
- 无需手动配置

---

## 🎓 最佳实践

### 提示词编写技巧

1. **明确描述效果**
   ```
   ✅ 好：转换为印象派油画风格，增强色彩饱和度，添加艺术笔触
   ❌ 差：变成油画
   ```

2. **使用专业术语**
   ```
   ✅ 好：赛博朋克风格，霓虹灯光效果，蓝紫色调，未来科技感
   ❌ 差：科幻一点
   ```

3. **结合多个元素**
   ```
   ✅ 好：水彩画风格 + 柔和光线 + 梦幻氛围 + 暖色调
   ```

### 参数调节建议

**转换强度：**
- 0.1-0.3：轻微调整，保留原图特征
- 0.4-0.6：中等变化，平衡原图和效果
- 0.7-1.0：大幅变化，艺术性转换

**艺术风格：**
- 写实风格：适合照片优化
- 动漫风格：适合人像转换
- 油画水彩：适合风景和静物

---

## 📝 更新日志

### v1.0.0 (2025-10-22)
- ✅ 完整图生图功能
- ✅ 22个专业提示词模板
- ✅ 智能后端检测
- ✅ 自动降级方案
- ✅ 完整多语言支持
- ✅ 提示词优化器

---

## 💬 需要帮助？

- 📧 查看 `docs/` 目录下的其他文档
- 🌐 访问 Replicate 文档：https://replicate.com/docs
- 💡 参考示例代码：`test/test-*.html`

---

**祝您使用愉快！** 🎨✨
