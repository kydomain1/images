# é€šä¹‰ä¸‡ç›¸APIæ¥å…¥å®Œæ•´æŒ‡å—

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
1. è®¿é—®ï¼šhttps://www.aliyun.com/
2. ç‚¹å‡»"å…è´¹æ³¨å†Œ"
3. å®Œæˆæ‰‹æœºå·/é‚®ç®±æ³¨å†Œ
4. å®Œæˆå®åè®¤è¯ï¼ˆéœ€è¦èº«ä»½è¯ï¼‰

### 2. å¼€é€šé€šä¹‰ä¸‡ç›¸æœåŠ¡
1. è®¿é—®ï¼šhttps://dashscope.aliyun.com/
2. ä½¿ç”¨é˜¿é‡Œäº‘è´¦å·ç™»å½•
3. ç‚¹å‡»"å¼€é€šDashScope"æœåŠ¡
4. æ–°ç”¨æˆ·å¯è·å¾— **100ä¸‡Tokenså…è´¹é¢åº¦**ï¼ˆçº¦1000æ¬¡å›¾ç‰‡ç”Ÿæˆï¼‰

### 3. è·å–API Key

#### æ–¹æ³•Aï¼šä½¿ç”¨DashScopeæ§åˆ¶å°ï¼ˆæ¨èï¼‰
1. ç™»å½•ï¼šhttps://dashscope.console.aliyun.com/
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ "API-KEYç®¡ç†"
3. ç‚¹å‡»"åˆ›å»ºæ–°çš„API-KEY"
4. å¤åˆ¶ç”Ÿæˆçš„API Keyï¼ˆæ ¼å¼ï¼šsk-xxxxxxxxxxxxxxxxï¼‰
5. **é‡è¦**ï¼šå¦¥å–„ä¿å­˜ï¼Œåªæ˜¾ç¤ºä¸€æ¬¡ï¼

#### æ–¹æ³•Bï¼šä½¿ç”¨é˜¿é‡Œäº‘RAM
1. è®¿é—®ï¼šhttps://ram.console.aliyun.com/
2. åˆ›å»ºRAMç”¨æˆ·
3. æˆäºˆ"AliyunDashScopeFullAccess"æƒé™
4. åˆ›å»ºAccessKey

## ğŸ”§ é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹APIé…ç½®æ–‡ä»¶

æ‰“å¼€ `js/api-config.js`ï¼Œè¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š

```javascript
const API_CONFIG = {
    // 1. å°†provideræ”¹ä¸ºtongyi
    provider: 'tongyi',
    
    // 2. é…ç½®é€šä¹‰ä¸‡ç›¸
    tongyi: {
        apiKey: 'sk-ä½ çš„çœŸå®API-KEY', // ç²˜è´´ä½ çš„API Key
        endpoint: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis'
    }
};
```

### ç¬¬äºŒæ­¥ï¼šæµ‹è¯•é…ç½®

1. ä¿å­˜æ–‡ä»¶
2. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
3. æ‰“å¼€ `tool.html`
4. è¾“å…¥æç¤ºè¯ï¼š"ä¸€åªå¯çˆ±çš„ç†ŠçŒ«åœ¨åƒç«¹å­"
5. ç‚¹å‡»"ç”Ÿæˆå›¾ç‰‡"
6. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

## ğŸ“ å®Œæ•´ä»£ç å®ç°

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†é€šä¹‰ä¸‡ç›¸çš„é›†æˆä»£ç ï¼Œè¯·æŸ¥çœ‹ `js/tongyi-api.js` æ–‡ä»¶ã€‚

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```javascript
// ç®€å•æç¤ºè¯
"ä¸€åªå¯çˆ±çš„æ©˜çŒ«ååœ¨çª—å°ä¸Š"

// è¯¦ç»†æç¤ºè¯ï¼ˆæ•ˆæœæ›´å¥½ï¼‰
"ä¸€åªå¯çˆ±çš„æ©˜çŒ«ååœ¨çª—å°ä¸Šï¼Œé˜³å…‰æ´’åœ¨å®ƒçš„èº«ä¸Šï¼Œæ¸©æš–çš„åˆåï¼Œæ²¹ç”»é£æ ¼ï¼Œç»†èŠ‚ä¸°å¯Œï¼ŒæŸ”å’Œçš„å…‰çº¿"
```

### é«˜çº§ç”¨æ³•
```javascript
// ä½¿ç”¨è´Ÿé¢æç¤ºè¯
æ­£é¢æç¤ºè¯: "ç¾ä¸½çš„é£æ™¯ç”»ï¼Œé«˜å±±æµæ°´ï¼Œè“å¤©ç™½äº‘"
è´Ÿé¢æç¤ºè¯: "æ¨¡ç³Šï¼Œä½è´¨é‡ï¼Œå˜å½¢ï¼Œæ°´å°ï¼Œæ–‡å­—"

// æŒ‡å®šé£æ ¼
"èµ›åšæœ‹å…‹é£æ ¼çš„æœªæ¥åŸå¸‚ï¼Œéœ“è™¹ç¯ï¼Œå¤œæ™šï¼Œç§‘æŠ€æ„Ÿ"
```

## ğŸ’° è´¹ç”¨è¯´æ˜

### å…è´¹é¢åº¦
- **æ–°ç”¨æˆ·**ï¼š100ä¸‡Tokensï¼ˆçº¦1000-2000å¼ å›¾ç‰‡ï¼‰
- **æœ‰æ•ˆæœŸ**ï¼š3ä¸ªæœˆ

### ä»˜è´¹ä»·æ ¼ï¼ˆè¶…å‡ºå…è´¹é¢åº¦åï¼‰
- **wanx-v1**ï¼š0.08å…ƒ/å¼ ï¼ˆ1024x1024ï¼‰
- **wanx-sketch-to-image-v1**ï¼š0.08å…ƒ/å¼ 
- **wanx-style-repaint-v1**ï¼š0.08å…ƒ/å¼ 

### æŸ¥çœ‹ç”¨é‡
1. è®¿é—®ï¼šhttps://dashscope.console.aliyun.com/billing
2. æŸ¥çœ‹"ç”¨é‡ç»Ÿè®¡"
3. å®æ—¶ç›‘æ§æ¶ˆè´¹æƒ…å†µ

## ğŸš€ APIèƒ½åŠ›

é€šä¹‰ä¸‡ç›¸æ”¯æŒçš„åŠŸèƒ½ï¼š

### 1. æ–‡å­—ç”Ÿæˆå›¾ç‰‡ (Text-to-Image)
```javascript
// å·²åœ¨é¡¹ç›®ä¸­å®ç°
{
    model: "wanx-v1",
    input: {
        prompt: "ä½ çš„æè¿°"
    },
    parameters: {
        size: "1024*1024",
        n: 1
    }
}
```

### 2. å›¾ç‰‡é£æ ¼é‡ç»˜
```javascript
{
    model: "wanx-style-repaint-v1",
    input: {
        image_url: "åŸå›¾URL",
        prompt: "é£æ ¼æè¿°"
    }
}
```

### 3. è‰å›¾è½¬å›¾ç‰‡
```javascript
{
    model: "wanx-sketch-to-image-v1",
    input: {
        sketch_image_url: "è‰å›¾URL",
        prompt: "è¯¦ç»†æè¿°"
    }
}
```

## âš™ï¸ å‚æ•°è¯´æ˜

### sizeï¼ˆå›¾ç‰‡å°ºå¯¸ï¼‰
- `1024*1024`ï¼ˆæ­£æ–¹å½¢ï¼‰
- `720*1280`ï¼ˆç«–å‘ï¼‰
- `1280*720`ï¼ˆæ¨ªå‘ï¼‰

### nï¼ˆç”Ÿæˆæ•°é‡ï¼‰
- èŒƒå›´ï¼š1-4
- å»ºè®®ï¼š1-2ï¼ˆèŠ‚çœé¢åº¦ï¼‰

### seedï¼ˆéšæœºç§å­ï¼‰
- ç›¸åŒseed + ç›¸åŒprompt = ç›¸åŒå›¾ç‰‡
- ç”¨äºå¤ç°ç»“æœ

### ref_modeï¼ˆå‚è€ƒæ¨¡å¼ï¼‰
- `repaint`ï¼šé‡ç»˜æ¨¡å¼
- é»˜è®¤ï¼šæ ‡å‡†ç”Ÿæˆ

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### Q1: "Invalid API Key" é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆsk-å¼€å¤´ï¼‰
2. ç¡®è®¤API Keyæ²¡æœ‰å¤šä½™ç©ºæ ¼
3. æ£€æŸ¥æ˜¯å¦å¼€é€šäº†DashScopeæœåŠ¡
4. å°è¯•é‡æ–°ç”ŸæˆAPI Key

### Q2: "Insufficient Balance" é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å…è´¹é¢åº¦æ˜¯å¦ç”¨å®Œ
2. å‰å¾€æ§åˆ¶å°å……å€¼
3. æŸ¥çœ‹è´¦å•æ˜ç»†

### Q3: å›¾ç‰‡ç”Ÿæˆå¾ˆæ…¢
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é€šä¹‰ä¸‡ç›¸ç”Ÿæˆæ—¶é—´çº¦10-30ç§’
2. å»ºè®®å•æ¬¡ç”Ÿæˆ1-2å¼ å›¾ç‰‡
3. é¿å…é«˜å³°æ—¶æ®µï¼ˆå·¥ä½œæ—¥9-12ç‚¹ï¼Œ14-18ç‚¹ï¼‰

### Q4: æç¤ºè¯æ— æ³•è¯†åˆ«
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ä¸­æ–‡æè¿°ï¼ˆé€šä¹‰ä¸‡ç›¸å¯¹ä¸­æ–‡æ”¯æŒæœ€å¥½ï¼‰
2. æè¿°è¦å…·ä½“æ˜ç¡®
3. é¿å…è¿‡äºæŠ½è±¡çš„æ¦‚å¿µ

### Q5: è·¨åŸŸ(CORS)é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// è¿™æ˜¯æ­£å¸¸çš„ï¼é€šä¹‰ä¸‡ç›¸APIéœ€è¦é€šè¿‡åç«¯è°ƒç”¨
// è¯·æŸ¥çœ‹ä¸‹é¢çš„"ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"ç« èŠ‚
```

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**é‡è¦**ï¼šé€šä¹‰ä¸‡ç›¸APIä¸æ”¯æŒç›´æ¥åœ¨æµè§ˆå™¨è°ƒç”¨ï¼ˆCORSé™åˆ¶ï¼‰ï¼Œéœ€è¦é€šè¿‡åç«¯æœåŠ¡å™¨ã€‚

### Node.js åç«¯ç¤ºä¾‹

åˆ›å»º `server.js`ï¼š

```javascript
const express = require('express');
const axios = require('axios');
const app = express();

app.use(express.json());

// é€šä¹‰ä¸‡ç›¸ä»£ç†æ¥å£
app.post('/api/tongyi/generate', async (req, res) => {
    const { prompt, size, count } = req.body;
    
    try {
        const response = await axios.post(
            'https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis',
            {
                model: "wanx-v1",
                input: {
                    prompt: prompt
                },
                parameters: {
                    size: size || "1024*1024",
                    n: count || 1
                }
            },
            {
                headers: {
                    'Authorization': `Bearer ${process.env.TONGYI_API_KEY}`,
                    'Content-Type': 'application/json',
                    'X-DashScope-Async': 'enable'
                }
            }
        );
        
        res.json(response.data);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

app.listen(3000, () => {
    console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000');
});
```

å¯åŠ¨æœåŠ¡å™¨ï¼š
```bash
# å®‰è£…ä¾èµ–
npm install express axios dotenv

# è®¾ç½®ç¯å¢ƒå˜é‡
echo "TONGYI_API_KEY=ä½ çš„API-KEY" > .env

# å¯åŠ¨æœåŠ¡å™¨
node server.js
```

### Python Flask åç«¯ç¤ºä¾‹

åˆ›å»º `app.py`ï¼š

```python
from flask import Flask, request, jsonify
import requests
import os

app = Flask(__name__)

@app.route('/api/tongyi/generate', methods=['POST'])
def generate_image():
    data = request.json
    
    headers = {
        'Authorization': f'Bearer {os.getenv("TONGYI_API_KEY")}',
        'Content-Type': 'application/json',
        'X-DashScope-Async': 'enable'
    }
    
    payload = {
        'model': 'wanx-v1',
        'input': {
            'prompt': data['prompt']
        },
        'parameters': {
            'size': data.get('size', '1024*1024'),
            'n': data.get('count', 1)
        }
    }
    
    response = requests.post(
        'https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis',
        headers=headers,
        json=payload
    )
    
    return jsonify(response.json())

if __name__ == '__main__':
    app.run(port=3000)
```

å¯åŠ¨æœåŠ¡å™¨ï¼š
```bash
# å®‰è£…ä¾èµ–
pip install flask requests python-dotenv

# è®¾ç½®ç¯å¢ƒå˜é‡
export TONGYI_API_KEY=ä½ çš„API-KEY

# å¯åŠ¨æœåŠ¡å™¨
python app.py
```

## ğŸ“Š æµ‹è¯•å·¥å…·

æˆ‘ä¸ºæ‚¨åˆ›å»ºäº†æµ‹è¯•è„šæœ¬ï¼Œè¯·æŸ¥çœ‹ `test-tongyi.html`

## ğŸ“š å®˜æ–¹æ–‡æ¡£

- **æ§åˆ¶å°**ï¼šhttps://dashscope.console.aliyun.com/
- **APIæ–‡æ¡£**ï¼šhttps://help.aliyun.com/zh/dashscope/developer-reference/api-details-9
- **SDKæ–‡æ¡£**ï¼šhttps://help.aliyun.com/zh/dashscope/developer-reference/sdk-overview
- **å®šä»·è¯´æ˜**ï¼šhttps://help.aliyun.com/zh/dashscope/developer-reference/tongyi-wanxiang-metering-and-billing

## ğŸ‰ å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] å·²æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
- [ ] å·²å®Œæˆå®åè®¤è¯
- [ ] å·²å¼€é€šDashScopeæœåŠ¡
- [ ] å·²è·å–API Key
- [ ] å·²ä¿®æ”¹ `js/api-config.js` é…ç½®
- [ ] å·²æµ‹è¯•å›¾ç‰‡ç”ŸæˆåŠŸèƒ½
- [ ] å·²äº†è§£è´¹ç”¨æƒ…å†µ

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

1. **æç¤ºè¯ä¼˜åŒ–**ï¼šä½¿ç”¨ä¸­æ–‡ï¼Œæè¿°è¯¦ç»†
2. **æˆæœ¬æ§åˆ¶**ï¼šè®¾ç½®æ¯æ—¥ç”Ÿæˆä¸Šé™
3. **å¼‚æ­¥å¤„ç†**ï¼šé€šä¹‰ä¸‡ç›¸æ”¯æŒå¼‚æ­¥ç”Ÿæˆï¼Œé€‚åˆæ‰¹é‡å¤„ç†
4. **ç¼“å­˜ç­–ç•¥**ï¼šç›¸åŒæç¤ºè¯å¯ç¼“å­˜ç»“æœ
5. **é”™è¯¯é‡è¯•**ï¼šç½‘ç»œé—®é¢˜æ—¶è‡ªåŠ¨é‡è¯•

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£æˆ–è”ç³»é˜¿é‡Œäº‘å®¢æœã€‚ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸš€


